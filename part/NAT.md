**网络地址转换**（NAT Network Address Translation）是一个IETF标准，是将IP数据报文头中的IP地址转换为另一个IP地址的过程。IP地址的日益短缺是NAT技术提出的背景。一个局域网内部有很多台主机，但不是每台主机都有合法的IP地址，为了使所有内部主机都可以连接Internet，需要使用地址转换，NAT技术使得一个私有网络可以通过Internet注册IP连接到外部网络。

### NAT简介
在实际应用中，共有的IP地址不足以为每台设备都安排一个地址连接到Internet，在局域网的内部通常使用RFC1918定义的私有IP地址。


#### 私有IP地址的范围
网络类型 | 私有地址范围
|:-:|-| 
|A类|10.0.0.0~10.255.255.255|
|B类|172.16.0.0~172.31.255.255|
|C类|192.168.0.0~192.168.255.255|

NAT主要应用在连接两个网络的边缘设备上，用于实现允许内部网络用户访问外部公共网络，以及允许外部公共网络访问部分内部网络资源（例如内部服务器）的目的。NAT最初的设计目的是实现私有网络访问公共网络的功能，后扩展为实现任意两个网络间进行访问时的地址转换应用。它也可以应用到防火墙技术里，地址转换技术可以有效地隐藏内部局域网中的主机，具有一定的网络安全保护使作用。


#### NAT的特点
- 私有网络内部的通信利用私网地址，如果私有网络需要与外部网络通信或访问外部资源，则可通过将大量的私网地址转换成少量的公网地址来实现，这在一定程序上缓解了IPv4地址空间日益枯竭的压力。
- 地址转换可以利用端口信息，通过同时转换公网地址与传输层端口号，使得多个私网用户可共用一个公网地址与外部网络通信，节省了公网地址。
- 通过静态映射，不同的内部服务咕噜可以映射到同一个公网地址。外部用户可通过公网地址和端口访问不同的内部服务器，同时还隐藏了内部服务咕噜的真实IP地址，从而防止外部对内部服务器乃至内部网络的攻击。
- 方便网络管理，例如私网服务器迁移时，无须过多配置的改变，仅仅通过调整内部服务器的映射表就可以将这一变化体现出来。

NAT技术以一定优势解决了IP地址的利用率和安全等方面的问题，但它自身而言也存在一些问题，使用NAT技术的设备会降低设备的性能和增加网络延迟，NAT技术改变了IP地址参数使得对数据的监控和追踪变得复杂等。

#### NAT的类型
当使用NAT时，根据地址的位置及数据流的方向，有以下4种地址名称：
- 内部本地地址（指经过NAT转换的设备地址）
- 内部全局地址（指在网络内部使用的地址）
- 外部本地地址（指目的设备的地址）
- 外部全局地址（指在网络外部使用的地址）
![NAT地址类型示意网络](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1584365168724&di=c308883c0ba2ba69b7f75f1f5e5c1de6&imgtype=jpg&src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D581395739%2C3745741421%26fm%3D214%26gp%3D0.jpg)

#### 网络地址转换主要有3种类型
- 静态地址转换（静态    NAT）：本地地址和全局地址之间是一对一的地址映射
- 动态地址转换（动态NAT）：本地地址和全局地址之间是多对多的地址映射
- 商品地址转换（PAT）：本地地址和全局地址之间是多对一的地址映射

#### NAT工作原理
配置了NAT功能的连接内部网络和外部网络的边缘设备，通常被称为NAT设备。当内部网络访问外部网络的报文经过NAT设备时，NAT设备会用一个合法的公网地址替换原报文中的源IP地址，并对这种转换进行记录; 之后，当报文从外网侧返回时，NAT主备查找原有的记录，将报文的目的地址再替换回原来的私网地址，并转发给内网侧主机。这个过程，在私网侧或公网侧设备看来，与普通的网络访问并没有任何的区别。

一般地址转换的工作是由网络边缘的设备实施的，如路由器、防火墙等，目的是将IP数据包首部中的私有地址转换成公有地址。

1、静态NAT
静态NAT使用本地地址和全局地址一对一的映射，这些映射由网络管理员进行配置，并且保持不变，静态NAT表项如下所求


**静态NAT表项**
内部本地IP地址 | 内部全局IP地址
---|---
192.168.0.1 | 202.1.1.1
192.168.0.2 | 202.1.1.2

如上表中，路由器上配置了A和B两台PC内部地址的静态映射，当这些设备向Internet发送流量时，它们的内部地址将转换为已配置的内部全局地址，对外部网络而言，这些设备具有公有IP地址。

2、动态NAT使用公有的地址池，并以先到先得的原则分配这些地址，当内部设备请求访问外部设备时，动态NAT会从地址池中分配一个公共的IP地址。如PC机A已经使用动态NAT地址池中的IP地址访问Internet,其他地址仍然可供其他用户使用。


**动态NAT地址池**

内部本地IP地址 | 内部全局IP地址
:---:|:---:
192.168.0.1 | 202.1.1.1
可供使用| 202.1.1.2
可供使用| 202.1.1.3
可供使用| 202.1.1.4
可供使用| 202.1.1.5
可供使用| 202.1.1.6

3、端口地址转换(PAT)  
静态NAT和动态NAT类似，为了满足同时支持多用户上网，需要有足够的公有IP地址可用，显然公有IP地址的数量会成为一个难题。

端口地址转换（PAT）将多个私有IP地址映射到单个公有IP地址或多个仅有IP地址，这是目前多数情况所使用的Internet访问方法。PAT可以将多个地址映射到一个或少数几个公有IP地址，每个私有IP地址会用端口号加以跟踪，当设备发起TCP/IP会话时，它会生成TCP或UTP源商品号，以唯一标志一个用户。当NAT设备收到客户端的数据时，将使用端口号来唯一确定NAT的转换。

**PAT示例** 

协议|内部本地IP地址 | 内部全局IP地址
----|---|---
TCP|192.168.0.1:1024|202.1.1.1:1024
TCP|192.168.0.2:1034|202.1.1.1:1024
TCP|192.168.0.3:1044|202.1.1.1:1024








